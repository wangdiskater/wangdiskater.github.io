<!DOCTYPE html>





<html lang="zh-Hans">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 3.3.8">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.4.0">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.4.0">
  <link rel="mask-icon" href="/images/logo.svg?v=7.4.0" color="#222">

<link rel="stylesheet" href="/css/main.css?v=7.4.0">

<link rel="stylesheet" href="//fonts.proxy.ustclug.org/css?family=Lato:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext">
<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">


<script id="hexo-configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.4.0',
    exturl: false,
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":true},
    bookmark: {"enable":false,"color":"#222","save":"auto"},
    fancybox: false,
    mediumzoom: false,
    lazyload: false,
    pangu: false,
    algolia: {
      appID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    localsearch: {"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},
    path: '',
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    translation: {
      copy_button: '复制',
      copy_success: '复制成功',
      copy_failure: '复制失败'
    },
    sidebarPadding: 40
  };
</script>

  <meta name="description" content="星期六学习数据结构List主要就是学习源码为什么这样写。有几点需要注意：1）我们只学习核心的方法和迭代器的方法2）迭代器的指针是指向两个结点之间的位置上的。这一定要注意；3）一些细节上的问题我会说清楚整体结构1）我们需要一个List接口。两个list都继承这个接口的方法2）我们需要一个iterator接口，两个类的子类对象要继承这个接口的方法3）这个类的子类要和父类数据互通，不想被其他类访问最好就">
<meta property="og:type" content="article">
<meta property="og:title" content="Java总结（三）下">
<meta property="og:url" content="http://yoursite.com/2019/07/14/Java总结（三）下/index.html">
<meta property="og:site_name" content="路要坚持">
<meta property="og:description" content="星期六学习数据结构List主要就是学习源码为什么这样写。有几点需要注意：1）我们只学习核心的方法和迭代器的方法2）迭代器的指针是指向两个结点之间的位置上的。这一定要注意；3）一些细节上的问题我会说清楚整体结构1）我们需要一个List接口。两个list都继承这个接口的方法2）我们需要一个iterator接口，两个类的子类对象要继承这个接口的方法3）这个类的子类要和父类数据互通，不想被其他类访问最好就">
<meta property="og:locale" content="zh-Hans">
<meta property="og:updated_time" content="2019-08-17T03:16:04.333Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Java总结（三）下">
<meta name="twitter:description" content="星期六学习数据结构List主要就是学习源码为什么这样写。有几点需要注意：1）我们只学习核心的方法和迭代器的方法2）迭代器的指针是指向两个结点之间的位置上的。这一定要注意；3）一些细节上的问题我会说清楚整体结构1）我们需要一个List接口。两个list都继承这个接口的方法2）我们需要一个iterator接口，两个类的子类对象要继承这个接口的方法3）这个类的子类要和父类数据互通，不想被其他类访问最好就">
  <link rel="canonical" href="http://yoursite.com/2019/07/14/Java总结（三）下/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome: false,
    isPost: true,
    isPage: false,
    isArchive: false
  };
</script>

  <title>Java总结（三）下 | 路要坚持</title>
  








  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">
  <div class="container use-motion">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-meta">

    <div>
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">路要坚持</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>


<nav class="site-nav">
  
  <ul id="menu" class="menu">
      
      
      
        
        <li class="menu-item menu-item-home">
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
      
      
      
        
        <li class="menu-item menu-item-archives">
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档</a>

  </li>
  </ul>

</nav>
</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
            

          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
      <article itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block post">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2019/07/14/Java总结（三）下/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="王邸">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/head.jpeg">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="路要坚持">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">Java总结（三）下

          
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              
                
              

              <time title="创建时间：2019-07-14 21:11:14" itemprop="dateCreated datePublished" datetime="2019-07-14T21:11:14+08:00">2019-07-14</time>
            </span>
          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2019-08-17 11:16:04" itemprop="dateModified" datetime="2019-08-17T11:16:04+08:00">2019-08-17</time>
              </span>
            
          

          
            <span id="/2019/07/14/Java总结（三）下/" class="post-meta-item leancloud_visitors" data-flag-title="Java总结（三）下" title="阅读次数">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span class="leancloud-visitors-count"></span>
            </span>
          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="fa fa-comment-o"></i>
      </span>
        
      
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2019/07/14/Java总结（三）下/#comments" itemprop="discussionUrl"><span class="post-comments-count valine-comment-count" data-xid="/2019/07/14/Java总结（三）下/" itemprop="commentCount"></span></a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <h2 id="星期六"><a href="#星期六" class="headerlink" title="星期六"></a>星期六</h2><h3 id="学习数据结构List"><a href="#学习数据结构List" class="headerlink" title="学习数据结构List"></a>学习数据结构List</h3><p>主要就是学习源码为什么这样写。有几点需要注意：<br>1）我们只学习核心的方法和迭代器的方法<br>2）迭代器的指针是指向两个结点之间的位置上的。这一定要注意；<br>3）一些细节上的问题我会说清楚</p><h3 id="整体结构"><a href="#整体结构" class="headerlink" title="整体结构"></a>整体结构</h3><p>1）我们需要一个List接口。两个list都继承这个接口的方法<br>2）我们需要一个iterator接口，两个类的子类对象要继承这个接口的方法<br>3）这个类的子类要和父类数据互通，不想被其他类访问最好就放在内部类<br>4）出现的异常<br>IllegalArgumentException   抛出的异常表明向方法传递了一个不合法或不正确的参数。<br>ArrayStoreException       试图将错误类型的对象存储到一个对象数组时抛出的异常。<br>IndexOutOfBoundsException 指示某排序索引（例如对数组、字符串或向量的排序）超出范围时抛出。<br>ConcurrentModificationException ： 当方法检测到对象的并发修改，但不允许这种修改时，抛出此异常。<br>IllegalStateException  在非法或不适当的时间调用方法时产生的信号。换句话说，即 Java 环境或 Java 应用程序没有处于请求操作所要求的适当状态下。<br>NoSuchElementException  由 Enumeration 的 nextElement 方法抛出，表明枚举中没有更多的元素。</p><a id="more"></a>

<h3 id="实现的步骤（以ArrayList为例）；"><a href="#实现的步骤（以ArrayList为例）；" class="headerlink" title="实现的步骤（以ArrayList为例）；"></a>实现的步骤（以ArrayList为例）；</h3><p>1）先定义出List接口和iterator接口<br>2）然后写ArrayList<br>    1.属性<br>    2.构造方法<br>    3.重写List方法<br>3）实现iterator接口<br>    1.属性<br>    2.构造方法<br>    3.重写方法</p>
<h3 id="List接口"><a href="#List接口" class="headerlink" title="List接口"></a>List接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public interface MyList &#123;</div><div class="line">    boolean add(String s);</div><div class="line">    void add(int index, String s);</div><div class="line">    void clear();</div><div class="line">    boolean contains(String s);</div><div class="line">    String get(int index);</div><div class="line">    int indexOf(String s);</div><div class="line">    boolean isEmpty();</div><div class="line">    MyIterator iterator();</div><div class="line">    int lastIndexOf(String s);</div><div class="line">    String remove(int index);</div><div class="line">    boolean remove(String s);</div><div class="line">    String set(int index, String s);</div><div class="line">    int size();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="ListIterator接口"><a href="#ListIterator接口" class="headerlink" title="ListIterator接口"></a>ListIterator接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">public interface MyIterator &#123;</div><div class="line">    void add(String s);</div><div class="line">    boolean hasNext();</div><div class="line">    boolean hasPrevious();</div><div class="line">    String next();</div><div class="line">    String previous();</div><div class="line">    int nextIndex();</div><div class="line">    int previousIndex();</div><div class="line">    void remove();</div><div class="line">    void set(String s);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="源码解析ArrayList"><a href="#源码解析ArrayList" class="headerlink" title="源码解析ArrayList"></a>源码解析ArrayList</h3><p>  1.属性<br>    分析：首先ArrayList是顺序存储的，而且是一个动态的数组，所以我们需要一个数组装元素elements[]，一个属性表示容量。还需要属性来表示长度（size）,<strong>为了处理并发修改异常还需要一个属性来记录在迭代器迭代时候，集合有没有修改元素modCount</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">//属性</div><div class="line">public static final int MAX_CAPACITY = Integer.MAX_VALUE - 8; //最大长度</div><div class="line">public static final int DEFAULT_CAPACITY = 10; //默认长度</div><div class="line">private int size;</div><div class="line">private String[] elements;</div><div class="line">private int modCount; // modification count 统计修改的次数</div></pre></td></tr></table></figure>
<p>  2.构造方法<br>    分析：构造方法没有参数，就用默认容量还作为长度。或者用户会手动输入一个长度，对这个长度判断。是否超过最大长度<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">// 构造方法</div><div class="line">public MyArrayList() &#123;</div><div class="line">    elements = new String[DEFAULT_CAPACITY];</div><div class="line">&#125;</div><div class="line"></div><div class="line">public MyArrayList(int capacity) &#123;</div><div class="line">    if (capacity &lt; 0 || capacity &gt; MAX_CAPACITY) &#123;</div><div class="line">        throw new IllegalArgumentException(&quot;capacity=&quot; + capacity);</div><div class="line">    &#125;</div><div class="line">    elements = new String[capacity];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>  3.方法<br>  这里有两点要说明：<br>  <strong>1.先挑软柿子捏，至于为什么等下告诉你</strong><br>  <strong>2.在写方法时不一定全部都要自己动手，可以调用本类其他方法，当然内部类（iterator）可以调用外部类来实现自己的功能。当然这些方法一般都是软柿子，一个大的功能由小功能组成的</strong></p>
<p>add(s)调用同名的兄弟解决<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 在线性表末尾添加元素</div><div class="line"> * @param s 要添加的元素</div><div class="line"> * @return 添加成功返回true, 否则返回false</div><div class="line"> */</div><div class="line">@Override</div><div class="line">public boolean add(String s) &#123;</div><div class="line">    add(size, s);</div><div class="line">    return true;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>这个方法比较难了，主要难点在于<br>1.添加是否会使得数组本身就满了需要扩容<br>2.扩容的过程会不会出现大于集合最大长度的情况<br>3.扩容的最佳分配是什么（这里就默认扩容1.5倍）<br>4.同样需要进行modCount++ size++;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 在指定的索引位置添加元素</div><div class="line"> * @param index 索引</div><div class="line"> * @param s 添加的元素</div><div class="line"> */</div><div class="line">@Override</div><div class="line">public void add(int index, String s) &#123;</div><div class="line">    checkIndexForAdd(index);</div><div class="line">    // 确保容量够大</div><div class="line">    int minCapacity = size + 1;</div><div class="line">    if (minCapacity &gt; elements.length) &#123;   //需要扩容</div><div class="line">        // 计算新数组的长度</div><div class="line">        int newLength = calculateCapacity(minCapacity);</div><div class="line">        // 扩容</div><div class="line">        grow(newLength);</div><div class="line">    &#125;</div><div class="line">    // 添加元素</div><div class="line">    for(int i = size; i &gt; index; i--) &#123;</div><div class="line">        elements[i] = elements[i-1];</div><div class="line">    &#125;</div><div class="line">    elements[index] = s;</div><div class="line">    size++;</div><div class="line">    modCount++;</div><div class="line">&#125;</div><div class="line"></div><div class="line">private void grow(int newLength) &#123;</div><div class="line">    String[] newArr = new String[newLength];</div><div class="line">    for(int i = 0; i &lt; size; i++) &#123;</div><div class="line">        newArr[i] = elements[i];</div><div class="line">    &#125;</div><div class="line">    // 将elements指向新的数组</div><div class="line">    elements = newArr;</div><div class="line">&#125;</div><div class="line"></div><div class="line">private int calculateCapacity(int minCapacity) &#123;</div><div class="line">    if (minCapacity &gt; MAX_CAPACITY || minCapacity &lt; 0) &#123;</div><div class="line">        throw new IllegalArgumentException();//不是ArrayStoreException异常</div><div class="line">    &#125;</div><div class="line">    // 一定能存下这么多数据</div><div class="line">    int len = elements.length + (elements.length &gt;&gt; 1); //扩容1.5倍</div><div class="line">    if (len &gt; MAX_CAPACITY || len &lt; 0) &#123;</div><div class="line">        len = MAX_CAPACITY;</div><div class="line">    &#125;</div><div class="line">    // 返回minCapacity和len的较大值</div><div class="line">    return len &gt; minCapacity ? len : minCapacity;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>检查index是否符合添加的条件注意可以在size位置添加的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">private void checkIndexForAdd(int index) &#123;</div><div class="line">    if (index &lt; 0 || index &gt; size) &#123;</div><div class="line">        throw new IndexOutOfBoundsException(&quot;index=&quot; + index + &quot;, size=&quot; + size);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>注意清空操作算是修改链表长度的操作。需要modCount++<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 清空线性表</div><div class="line"> */</div><div class="line">@Override</div><div class="line">public void clear() &#123;</div><div class="line">    // elements = null;</div><div class="line">    modCount++;</div><div class="line">    for(int i = 0; i &lt; size; i++) &#123;</div><div class="line">        elements[i] = null;</div><div class="line">    &#125;</div><div class="line">    size = 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>contains调用indexOf(s)解决<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 判断元素是否在线性表中存在</div><div class="line"> * @param s 元素</div><div class="line"> * @return 如果存在返回true, 否则返回false</div><div class="line"> */</div><div class="line">@Override</div><div class="line">public boolean contains(String s) &#123;</div><div class="line">    int index = indexOf(s);</div><div class="line">    if (index == -1) &#123;</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line">    return true;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>直接返回数组元素值就行，软柿子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 获取指定索引位置的值</div><div class="line"> * @param index 索引</div><div class="line"> * @return 值</div><div class="line"> */</div><div class="line">@Override</div><div class="line">public String get(int index) &#123;</div><div class="line">    checkIndex(index);</div><div class="line">    return elements[index];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">private void checkIndex(int index) &#123;</div><div class="line">    if (index &lt; 0 || index &gt;= size) &#123;</div><div class="line">        throw new IndexOutOfBoundsException(&quot;index=&quot; + index + &quot;, size=&quot; + size);</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>indexOf是很多兄弟都要用到，所以这个方法是否正确就很重要了，不能马虎<br>需要判断用户给的String是不是null来判断<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 查找元素在线性表中第一次出现的位置</div><div class="line"> * @param s 查找的元素</div><div class="line"> * @return 第一次出现的位置，如果不存在返回-1.</div><div class="line"> */</div><div class="line">@Override</div><div class="line">public int indexOf(String s) &#123;</div><div class="line">    if (s == null) &#123;</div><div class="line">        for(int i = 0; i &lt; size; i++) &#123;</div><div class="line">            if (elements[i] == null) &#123;</div><div class="line">                return i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125; else &#123;</div><div class="line">        for(int i = 0; i &lt; size; i++) &#123;</div><div class="line">            if (s.equals(elements[i])) &#123;</div><div class="line">                return i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return -1;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>软柿子+1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 判空</div><div class="line"> */</div><div class="line">@Override</div><div class="line">public boolean isEmpty() &#123;</div><div class="line">    return size == 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>迭代器后面具体说<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public MyIterator iterator() &#123;</div><div class="line">    return new Itr(0) ;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public MyIterator iterator(int index) &#123;</div><div class="line">    checkIndexForAdd(index);</div><div class="line">    return new Itr(index);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>从后往前遍历也要判断一下用户传过来的null;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 查找元素在线性表中最后出现的索引</div><div class="line"> * @param s 查找的锇元素</div><div class="line"> * @return 最后一次的索引，如果不存在返回-1</div><div class="line"> */</div><div class="line">@Override</div><div class="line">public int lastIndexOf(String s) &#123;</div><div class="line">    if (s == null) &#123;</div><div class="line">        for(int i = size - 1; i &gt;= 0; i--) &#123;</div><div class="line">            if (elements[i] == null) &#123;</div><div class="line">                return i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125; else &#123;</div><div class="line">        for(int i = size - 1; i &gt;= 0; i--) &#123;</div><div class="line">            if (s.equals(elements[i])) &#123;</div><div class="line">                return i;</div><div class="line">            &#125;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return -1;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>通过下标找到位置<br>  1.拿出被删除的数<br>  2.然后移动数组<br>  3.记得modCount++因为修改了数组结构<br>  4.size–<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 删除指定索引位置的元素</div><div class="line"> * @param index 指定索引位置</div><div class="line"> * @return 被删除的元素</div><div class="line"> */</div><div class="line">@Override</div><div class="line">public String remove(int index) &#123;</div><div class="line">    checkIndex(index);</div><div class="line">    String oldValue = elements[index];</div><div class="line">    for(int i = index; i &lt; size - 1; i++) &#123;</div><div class="line">        elements[i] = elements[i+1];</div><div class="line">    &#125;</div><div class="line">    size--;</div><div class="line">    modCount++;</div><div class="line">    return oldValue;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>通过indexOf()找到下标然后给同名的兄弟remove(index)解决；<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 删除第一个值等于s的元素</div><div class="line"> * @param s 给定的值</div><div class="line"> * @return 如果删除成功返回true，否则返回false.</div><div class="line"> */</div><div class="line">@Override</div><div class="line">public boolean remove(String s) &#123;</div><div class="line">    int index = indexOf(s);</div><div class="line">    if (index == -1) &#123;</div><div class="line">        return false;</div><div class="line">    &#125;</div><div class="line">    remove(index);</div><div class="line">    return true;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>软柿子，记得检查一下用户输入index是否有问题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 把指定索引位置的值更新成新的值，并把旧的值返回</div><div class="line"> * @param index 索引</div><div class="line"> * @param s 新值</div><div class="line"> * @return 旧值</div><div class="line"> */</div><div class="line">@Override</div><div class="line">public String set(int index, String s) &#123;</div><div class="line">    checkIndex(index);</div><div class="line">    String oldValue = elements[index];</div><div class="line">    elements[index] = s;</div><div class="line">    return oldValue;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>软柿子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * 线性表存储元素的个数</div><div class="line"> * @return 线性表存储元素的个数</div><div class="line"> */</div><div class="line">@Override</div><div class="line">public int size() &#123;</div><div class="line">    return size;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>软柿子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public String toString() &#123;</div><div class="line">    StringBuilder sb = new StringBuilder(&quot;[&quot;);</div><div class="line">    for (int i = 0; i &lt; size; i++) &#123;</div><div class="line">        sb.append(elements[i]);</div><div class="line">        if (i != size - 1) &#123;</div><div class="line">            sb.append(&quot;, &quot;);</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return sb.append(&quot;]&quot;).toString();</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>—————————–内部类———————————————</p>
<p>接下来是内部类写迭代器也是老三样<br>  1.属性<br>  分析：首先需要cursor指向下一个元素，一个lastRet表示最近的访问的元素。还要校对是否出现并发修改异常设置一个exception<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">private int cursor; //后面元素的索引位置</div><div class="line">private int expModCount = modCount;</div><div class="line">private int lastRet = -1; // -1表示没有返回元素</div></pre></td></tr></table></figure></p>
<p>  2.构造方法 两种一种带index 一种不带。默认就调用index = 0 就行了<br>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public Itr(int index) &#123;</div><div class="line">    cursor = index;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>3.方法（<strong>注意看清楚操作的指针</strong>）<br>注意：先找软柿子捏</p>
<p>add:这个方法需要注意几个地方<br>1.添加了新的元素可以调用父类的add方法<br>2.修改了集合长度记得expModCount = modCount<br>调用父类的add modCount++了为什么不是expModCount ++？<br>考虑到了添加是集合的情况，直接赋值也是一样的结果<br>3.要把lastRet给质空 ，因为元素之间的关系已经改变不能在操作刚返回的元素了；<br>4.cursor++ ，cursor不++就会指向你刚添加的元素，这样连续添加时候并不会按照你添加顺序添加进入集合，而是反向。所以需要cursor++;<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void add(String s) &#123;</div><div class="line">    checkConcurrentModification();</div><div class="line">    MyArrayList.this.add(cursor, s);</div><div class="line">    expModCount = modCount;</div><div class="line">    cursor++;       // caution</div><div class="line">    lastRet = -1;    // caution</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>//判断是否会出现并发修改异常<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">private void checkConcurrentModification() &#123;</div><div class="line">    if (expModCount != modCount) &#123;</div><div class="line">        throw new ConcurrentModificationException();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>软柿子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public boolean hasNext() &#123;</div><div class="line">    return cursor &lt; size;</div><div class="line">&#125;</div><div class="line"></div><div class="line">@Override</div><div class="line">public boolean hasPrevious() &#123;</div><div class="line">    return cursor &gt; 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>核心方法：<br>1.首先判断是否有下一个元素<br>2.lastRet = cursor<br>3.cursor++<br>4.return elements[lastRet]<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public String next() &#123;</div><div class="line">    checkConcurrentModification();</div><div class="line">    if (!hasNext()) &#123;</div><div class="line">        throw new NoSuchElementException();</div><div class="line">    &#125;</div><div class="line">    lastRet = cursor;</div><div class="line">    return elements[cursor++];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>核心方法<br>同上这里注意cursor–;<br>此时cursor和lastRet指向的同一个元素哦<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public String previous() &#123;</div><div class="line">    checkConcurrentModification();</div><div class="line">    if (!hasPrevious()) &#123;</div><div class="line">        throw new NoSuchElementException();</div><div class="line">    &#125;</div><div class="line">    lastRet = cursor - 1;</div><div class="line">    /*String retValue = elements[cursor - 1];</div><div class="line">    cursor--;</div><div class="line">    return retValue;*/</div><div class="line">    return elements[--cursor];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>软柿子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public int nextIndex() &#123;</div><div class="line">    return cursor;</div><div class="line">&#125;</div><div class="line">@Override</div><div class="line">public int previousIndex() &#123;</div><div class="line">    return cursor - 1;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>remove最近返回的元素<br>注意事项：<br>1.这里判断lastRet是否存在不然抛出异常不该调用这个函数<br>2.expModCount = modCount 需要同步 增加和删除都需要<br>3.<strong>cursor = lastRet</strong>这个是为了不管正向遍历还是逆向遍历都能使得cursor位置不变；<br><em>首先看正向遍历：</em><br>|1|2|3|4|5|6|7|8|9|10|<br>假设正向遍历删除的是5  L表示last C 表示cursor<br>|1|2|3|4|5|6|7|8|9|10|<br>L在4|5之间，C在5|6之间<br>把5删掉之后因为集合删除会自动向前移动并排满，5的位置被6取代以此类推。那么cursor就会指向7，所以正向遍历必须cursor-1;</p>
<p><em>看逆向遍历：</em><br>|1|2|3|4|5|6|7|8|9|10|<br>假设逆向遍历删除的是5  L表示last C 表示cursor<br>|1|2|3|4|5|6|7|8|9|10|<br>C，L都在4|5之间</p>
<p>此时cursor和lastRet是指向同一个的这种情况就不用-1<br>所以综合两种情况把cursor = lastRet就行<br>4.lastRet置空因为修改了元素不想能够一直删除；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">@Override</div><div class="line">public void remove() &#123;</div><div class="line">    checkConcurrentModification();</div><div class="line">    if (lastRet == -1) &#123;</div><div class="line">        throw new IllegalStateException();</div><div class="line">    &#125;</div><div class="line">    MyArrayList.this.remove(lastRet);</div><div class="line">    expModCount = modCount;  //修改完就要同步count</div><div class="line">    cursor = lastRet; // caution: 正向遍历和逆向遍历的结果一致</div><div class="line">    lastRet = -1;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>设置元素<br>这里需要注意的是：<br>lastRet也要置空只要元素有改变都应该置空<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">    @Override</div><div class="line">    public void set(String s) &#123;</div><div class="line">        // 判断迭代器是否有效</div><div class="line">        checkConcurrentModification();</div><div class="line">        if (lastRet == -1) &#123;</div><div class="line">            throw new IllegalStateException();</div><div class="line">        &#125;</div><div class="line">        elements[lastRet] = s;</div><div class="line">        lastRet = -1;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<h3 id="ArrayList总结"><a href="#ArrayList总结" class="headerlink" title="ArrayList总结"></a>ArrayList总结</h3><p>1.难点在于ArrayList的扩容的机智<br>2.内部类的对指针的移动和判断并发修改异常</p>
<h3 id="源码解析linkedList"><a href="#源码解析linkedList" class="headerlink" title="源码解析linkedList"></a>源码解析linkedList</h3><p>直接看源码：因为之前没看过，所以今天就来学习一下</p>
<h3 id="List接口-1"><a href="#List接口-1" class="headerlink" title="List接口"></a>List接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">只看核心方法</div></pre></td></tr></table></figure>
<h3 id="ListIterator接口-1"><a href="#ListIterator接口-1" class="headerlink" title="ListIterator接口"></a>ListIterator接口</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">只看核心方法</div></pre></td></tr></table></figure>
<p>对于LinkedList来说应该没有什么难点，主要还是看迭代器里面的操作；因为是linkedList不需要考虑扩容的问题<br>先看看类名</p>
<pre><code>public class LinkedList&lt;E&gt;
extends AbstractSequentialList&lt;E&gt;
implements List&lt;E&gt;, Deque&lt;E&gt;, Cloneable, java.io.Serializable
</code></pre><p>属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">transient int size = 0;</div><div class="line">transient Node&lt;E&gt; first;  //定义第一个结点可变</div><div class="line">transient Node&lt;E&gt; last;   //定义最后一个结点可变</div><div class="line">protected transient int modCount = 0; //AbstractList定义</div></pre></td></tr></table></figure></p>
<p>1这里出现了关键字transient。Java中transient关键字的作用，简单地说，就是让某些被修饰的成员属性变量不被序列化<br>2这里需要看看Node是什么:一个静态内部类；相当于外部类？</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">private static class Node&lt;E&gt; &#123;</div><div class="line">    E item;</div><div class="line">    Node&lt;E&gt; next;</div><div class="line">    Node&lt;E&gt; prev;</div><div class="line"></div><div class="line">    Node(Node&lt;E&gt; prev, E element, Node&lt;E&gt; next) &#123;</div><div class="line">        this.item = element;</div><div class="line">        this.next = next;</div><div class="line">        this.prev = prev;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>构造方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">public LinkedList() &#123;</div><div class="line">&#125;</div><div class="line"></div><div class="line">public LinkedList(Collection&lt;? extends E&gt; c) &#123;</div><div class="line">    this();</div><div class="line">    addAll(c);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>方法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Links e as first element.</div><div class="line"> */</div><div class="line">private void linkFirst(E e) &#123;</div><div class="line">    final Node&lt;E&gt; f = first;</div><div class="line">    final Node&lt;E&gt; newNode = new Node&lt;&gt;(null, e, f);//这是头插法</div><div class="line">    first = newNode;</div><div class="line">    if (f == null)              // 说明里面一个结点都没有</div><div class="line">        last = newNode;</div><div class="line">    else</div><div class="line">        f.prev = newNode;       // first.prev = newNode;</div><div class="line">    size++;</div><div class="line">    modCount++;                 //在AbstractList定义</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在某个元素前面添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">void linkBefore(E e, Node&lt;E&gt; succ) &#123;</div><div class="line">    // assert succ != null;</div><div class="line">    final Node&lt;E&gt; pred = succ.prev;</div><div class="line">    final Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, succ);</div><div class="line">    succ.prev = newNode;</div><div class="line"></div><div class="line">    if (pred == null)</div><div class="line">        first = newNode;</div><div class="line">    else</div><div class="line">        pred.next = newNode;</div><div class="line"></div><div class="line">    size++;</div><div class="line">    modCount++;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>尾插法<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Links e as last element.</div><div class="line"> */</div><div class="line">void linkLast(E e) &#123;</div><div class="line">    final Node&lt;E&gt; l = last;</div><div class="line">    final Node&lt;E&gt; newNode = new Node&lt;&gt;(l, e, null);</div><div class="line">    last = newNode;</div><div class="line">    if (l == null)</div><div class="line">        first = newNode;</div><div class="line">    else</div><div class="line">        l.next = newNode;</div><div class="line">    size++;</div><div class="line">    modCount++;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>删除头结点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">/</div><div class="line"> * Unlinks non-null first node f.</div><div class="line"> */</div><div class="line">private E unlinkFirst(Node&lt;E&gt; f) &#123;</div><div class="line">    // assert f == first &amp;&amp; f != null;</div><div class="line">    final E element = f.item;      //获取要删除的值</div><div class="line">    final Node&lt;E&gt; next = f.next;   //获取first的下一个结点（未知）</div><div class="line">    f.item = null;</div><div class="line">    f.next = null; // help GC</div><div class="line">    first = next;</div><div class="line">    //如果原本就只有一个结点，现在毛都没了</div><div class="line">    if (next == null)</div><div class="line">        last = null;</div><div class="line">    else</div><div class="line">        next.prev = null;    //next作为头结点把和之前first链接断开</div><div class="line">    size--;</div><div class="line">    modCount++;</div><div class="line">    return element;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>删除最后一个结点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">private E unlinkLast(Node&lt;E&gt; l) &#123;</div><div class="line">    // assert l == last &amp;&amp; l != null;</div><div class="line"></div><div class="line">    final E element = l.item;</div><div class="line">    final Node&lt;E&gt; prev = l.prev;</div><div class="line">    l.item = null;</div><div class="line">    l.prev = null; // help GC</div><div class="line">    last = prev;</div><div class="line"></div><div class="line">    if (prev == null)</div><div class="line">        first = null;</div><div class="line">    else</div><div class="line">        prev.next = null;</div><div class="line">    size--;</div><div class="line">    modCount++;</div><div class="line">    return element;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>删除任意一个结点<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">/**</div><div class="line"> * Unlinks non-null node x.</div><div class="line"> */</div><div class="line">E unlink(Node&lt;E&gt; x) &#123;</div><div class="line">    // assert x != null;</div><div class="line">    final E element = x.item;</div><div class="line">    final Node&lt;E&gt; next = x.next;</div><div class="line">    final Node&lt;E&gt; prev = x.prev;</div><div class="line"></div><div class="line">    if (prev == null) &#123;   //如果删除的是头结点</div><div class="line">        first = next;</div><div class="line">    &#125; else &#123;</div><div class="line">        prev.next = next;</div><div class="line">        x.prev = null;    //help GC</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (next == null) &#123;  //如果删除是最后一个结点</div><div class="line">        last = prev;</div><div class="line">    &#125; else &#123;</div><div class="line">        next.prev = prev;</div><div class="line">        x.next = null;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    x.item = null;  //help GC</div><div class="line">    size--;</div><div class="line">    modCount++;</div><div class="line">    return element;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>在index添加一个集合<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div></pre></td><td class="code"><pre><div class="line">public boolean addAll(int index, Collection&lt;? extends E&gt; c) &#123;</div><div class="line">    checkPositionIndex(index);</div><div class="line"></div><div class="line">    Object[] a = c.toArray();</div><div class="line">    int numNew = a.length;</div><div class="line">    if (numNew == 0)</div><div class="line">        return false;</div><div class="line"></div><div class="line">    Node&lt;E&gt; pred, succ;</div><div class="line">    if (index == size) &#123;</div><div class="line">        succ = null;</div><div class="line">        pred = last;</div><div class="line">    &#125; else &#123;</div><div class="line">        succ = node(index);</div><div class="line">        pred = succ.prev;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    for (Object o : a) &#123;</div><div class="line">        @SuppressWarnings(&quot;unchecked&quot;) E e = (E) o;</div><div class="line">        Node&lt;E&gt; newNode = new Node&lt;&gt;(pred, e, null);</div><div class="line">        if (pred == null)</div><div class="line">            first = newNode;</div><div class="line">        else</div><div class="line">            pred.next = newNode;</div><div class="line">        pred = newNode;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    if (succ == null) &#123;</div><div class="line">        last = pred;</div><div class="line">    &#125; else &#123;</div><div class="line">        //连接原版在index的元素</div><div class="line">        pred.next = succ;</div><div class="line">        succ.prev = pred;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    size += numNew;</div><div class="line">    modCount++;</div><div class="line">    return true;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>indexOf和arrayList差不多<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">public int indexOf(Object o) &#123;</div><div class="line">    int index = 0;</div><div class="line">    if (o == null) &#123;</div><div class="line">        for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123;</div><div class="line">            if (x.item == null)</div><div class="line">                return index;</div><div class="line">            index++;</div><div class="line">        &#125;</div><div class="line">    &#125; else &#123;</div><div class="line">        for (Node&lt;E&gt; x = first; x != null; x = x.next) &#123;</div><div class="line">            if (o.equals(x.item))</div><div class="line">                return index;</div><div class="line">            index++;</div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line">    return -1;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>寻找Node的index方法，就分半查找<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">Node&lt;E&gt; node(int index) &#123;</div><div class="line">    // assert isElementIndex(index);</div><div class="line"></div><div class="line">    if (index &lt; (size &gt;&gt; 1)) &#123;</div><div class="line">        Node&lt;E&gt; x = first;</div><div class="line">        for (int i = 0; i &lt; index; i++)</div><div class="line">            x = x.next;</div><div class="line">        return x;</div><div class="line">    &#125; else &#123;</div><div class="line">        Node&lt;E&gt; x = last;</div><div class="line">        for (int i = size - 1; i &gt; index; i--)</div><div class="line">            x = x.prev;</div><div class="line">        return x;</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>接下来来看LinkedList的迭代器吧<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">private class ListItr implements ListIterator&lt;E&gt; &#123;</div></pre></td></tr></table></figure></p>
<p>//属性<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">private Node&lt;E&gt; lastReturned;</div><div class="line">private Node&lt;E&gt; next;</div><div class="line">private int nextIndex;</div><div class="line">private int expectedModCount = modCount;</div></pre></td></tr></table></figure></p>
<p>//构造函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ListItr(int index) &#123;</div><div class="line">    // assert isPositionIndex(index);</div><div class="line">    next = (index == size) ? null : node(index);</div><div class="line">    nextIndex = index;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>//软柿子<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public boolean hasNext() &#123;</div><div class="line">    return nextIndex &lt; size;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public E next() &#123;</div><div class="line">    checkForComodification();</div><div class="line">    if (!hasNext())</div><div class="line">        throw new NoSuchElementException();</div><div class="line"></div><div class="line">    lastReturned = next;</div><div class="line">    next = next.next;</div><div class="line">    nextIndex++;</div><div class="line">    return lastReturned.item;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public boolean hasPrevious() &#123;</div><div class="line">    return nextIndex &gt; 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">public E previous() &#123;</div><div class="line">    checkForComodification();</div><div class="line">    if (!hasPrevious())</div><div class="line">        throw new NoSuchElementException();</div><div class="line"></div><div class="line">    //lastReturned = next = (next == null) ? last : next.prev;</div><div class="line">    next = (next == null) ? last : next.prev;</div><div class="line">    lastRetured = next;</div><div class="line"></div><div class="line">    nextIndex--;</div><div class="line">    return lastReturned.item;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public int nextIndex() &#123;</div><div class="line">    return nextIndex;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">public int previousIndex() &#123;</div><div class="line">    return nextIndex - 1;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div></pre></td><td class="code"><pre><div class="line">public void remove() &#123;</div><div class="line">    checkForComodification();</div><div class="line">    if (lastReturned == null)</div><div class="line">        throw new IllegalStateException();</div><div class="line"></div><div class="line">    Node&lt;E&gt; lastNext = lastReturned.next;</div><div class="line">    unlink(lastReturned);</div><div class="line"></div><div class="line">    if (next == lastReturned) //说明是逆序遍历的</div><div class="line">        next = lastNext;</div><div class="line">    else                      //正序遍历</div><div class="line">        nextIndex--;</div><div class="line">    lastReturned = null;</div><div class="line">    expectedModCount++;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">public void set(E e) &#123;</div><div class="line">    if (lastReturned == null)</div><div class="line">        throw new IllegalStateException();</div><div class="line">    checkForComodification();</div><div class="line">    lastReturned.item = e;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public void add(E e) &#123;</div><div class="line">    checkForComodification();</div><div class="line">    lastReturned = null;</div><div class="line">    if (next == null)</div><div class="line">        linkLast(e);</div><div class="line">    else</div><div class="line">        linkBefore(e, next);</div><div class="line">    nextIndex++;</div><div class="line">    expectedModCount++;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">public void forEachRemaining(Consumer&lt;? super E&gt; action) &#123;</div><div class="line">    Objects.requireNonNull(action);</div><div class="line">    while (modCount == expectedModCount &amp;&amp; nextIndex &lt; size) &#123;</div><div class="line">        action.accept(next.item);</div><div class="line">        lastReturned = next;</div><div class="line">        next = next.next;</div><div class="line">        nextIndex++;</div><div class="line">    &#125;</div><div class="line">    checkForComodification();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">    final void checkForComodification() &#123;</div><div class="line">        if (modCount != expectedModCount)</div><div class="line">            throw new ConcurrentModificationException();</div><div class="line">    &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>这里写了ArrayList和LinkedList的源码，所以看起来有一点乱。但是两个类的作者肯定是不同的，我发现ArrayList用了很多try来想解决异常。但是LinkedList多了很多花哨的写法，所以看起来有一点费劲。总的来说学习LinkedList的思路，就是把head last设置成两个动态的结点，就只是一个标记。而不是定死的头和尾结点。所以判断时候就有一点难看懂，不过都还好。</p>

    </div>

    
    
    
        
      

      <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-next post-nav-item">
              
                <a href="/2019/07/14/Java总结（三）上/" rel="next" title="Java总结（三）上">
                  <i class="fa fa-chevron-left"></i> Java总结（三）上
                </a>
              
            </div>

            <span class="post-nav-divider"></span>

            <div class="post-nav-prev post-nav-item">
              
                <a href="/2019/07/21/Java总结（四）上/" rel="prev" title="Java总结（四）上">
                  Java总结（四）上 <i class="fa fa-chevron-right"></i>
                </a>
              
            </div>
          </div>
        
      </footer>
    
  </div>
  
  
  
  </article>

  </div>


          </div>
          
    
    <div class="comments" id="comments"></div>
  

        </div>
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
        
        
        
        
      

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#星期六"><span class="nav-number">1.</span> <span class="nav-text">星期六</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#学习数据结构List"><span class="nav-number">1.1.</span> <span class="nav-text">学习数据结构List</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#整体结构"><span class="nav-number">1.2.</span> <span class="nav-text">整体结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#实现的步骤（以ArrayList为例）；"><span class="nav-number">1.3.</span> <span class="nav-text">实现的步骤（以ArrayList为例）；</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#List接口"><span class="nav-number">1.4.</span> <span class="nav-text">List接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ListIterator接口"><span class="nav-number">1.5.</span> <span class="nav-text">ListIterator接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#源码解析ArrayList"><span class="nav-number">1.6.</span> <span class="nav-text">源码解析ArrayList</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ArrayList总结"><span class="nav-number">1.7.</span> <span class="nav-text">ArrayList总结</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#源码解析linkedList"><span class="nav-number">1.8.</span> <span class="nav-text">源码解析linkedList</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#List接口-1"><span class="nav-number">1.9.</span> <span class="nav-text">List接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ListIterator接口-1"><span class="nav-number">1.10.</span> <span class="nav-text">ListIterator接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#总结"><span class="nav-number">1.11.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></div>
        
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image"
      src="/images/head.jpeg"
      alt="王邸">
  <p class="site-author-name" itemprop="name">王邸</p>
  <div class="site-description" itemprop="description"></div>
</div>
  <nav class="site-state motion-element">
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">42</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
    
      
      
      <div class="site-state-item site-state-tags">
        
        <span class="site-state-item-count">3</span>
        <span class="site-state-item-name">标签</span>
        
      </div>
    
  </nav>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2020</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">王邸</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> 强力驱动 v3.3.8</div>
  <span class="post-meta-divider">|</span>
  <div class="theme-info">主题 – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.4.0</div>

        












        
      </div>
    </footer>
  </div>

  


  <script src="/lib/anime.min.js?v=3.1.0"></script>
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
<script src="/js/utils.js?v=7.4.0"></script><script src="/js/motion.js?v=7.4.0"></script>
<script src="/js/schemes/pisces.js?v=7.4.0"></script>

<script src="/js/next-boot.js?v=7.4.0"></script>



  





















  

  

  


<script>
NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
  var GUEST = ['nick', 'mail', 'link'];
  var guest = 'nick,mail,link';
  guest = guest.split(',').filter(item => {
    return GUEST.includes(item);
  });
  new Valine({
    el: '#comments',
    verify: false,
    notify: false,
    appId: 'Fn4BuvoixOxjJAhR79TvaD5M-gzGzoHsz',
    appKey: '1uspTrSwPqkmSBSUr948WqxE',
    placeholder: 'Just go go',
    avatar: 'mm',
    meta: guest,
    pageSize: '10' || 10,
    visitor: true,
    lang: '' || 'zh-cn',
    path: location.pathname
  });
}, window.Valine);
</script>

</body>
</html>
